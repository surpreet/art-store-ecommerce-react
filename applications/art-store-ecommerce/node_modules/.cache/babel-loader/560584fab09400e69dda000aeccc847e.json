{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\Arezoo\\\\Desktop\\\\comit\\\\comit-react-project\\\\applications\\\\art-store-ecommerce\\\\src\\\\components\\\\UserProvider.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport React, { useState, useContext, createContext } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport { createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, getToken } from \"../firebase/auth\";\nimport { getUser, addUser, getCartItems } from \"../firebase/userRepository\"; // import { addItemToCart } from \"../api/itemRepository\";\n\nconst UserContext = /*#__PURE__*/createContext();\nexport const useUser = () => {\n  _s();\n\n  return useContext(UserContext);\n};\n\n_s(useUser, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\n\nexport default function UserProvider(props) {\n  _s2();\n\n  const history = useHistory();\n  const [user, setUser] = useState(null);\n  const [currentError, setCurrentError] = useState(null);\n\n  const updateState = userData => {\n    console.log(userData);\n    setUser({ ...userData\n    });\n    setCurrentError(null);\n    history.push(\"/\");\n  };\n\n  const handleSubmitSignUp = async (event, email, password) => {\n    event.preventDefault();\n\n    try {\n      const authUser = await createUserWithEmailAndPassword(email, password);\n      const userData = addUser({\n        email,\n        uid: authUser.user.uid\n      });\n      updateState(userData);\n    } catch (error) {\n      setCurrentError(error);\n    }\n  };\n\n  const handleSubmitLogin = async (event, email, password) => {\n    event.preventDefault();\n\n    try {\n      const authUser = await signInWithEmailAndPassword(email, password);\n      const token = await getToken();\n      const userData = await getUser(authUser.user.uid);\n      userData.token = token;\n      userData.cart = await getCartItems(authUser.user.uid);\n      updateState(userData);\n    } catch (error) {\n      setCurrentError(error);\n    }\n  };\n\n  const handleSignOut = async () => {\n    try {\n      console.log(\"Calling signOut\");\n      const result = await signOut();\n      console.log(result);\n      setUser(null);\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  const handleAddToCartClick = async item => {\n    try {\n      await addItemToCart(user.uid, item.id, user.token);\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(UserContext.Provider, {\n    value: {\n      user,\n      error: currentError,\n      handleSubmitSignUp,\n      handleSubmitLogin,\n      handleSignOut,\n      handleAddToCartClick\n    },\n    children: props.children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 78,\n    columnNumber: 5\n  }, this);\n}\n\n_s2(UserProvider, \"IJR1AT7ep1gDVjDKkZDdoUhNPYM=\", false, function () {\n  return [useHistory];\n});\n\n_c = UserProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"UserProvider\");","map":{"version":3,"sources":["C:/Users/Arezoo/Desktop/comit/comit-react-project/applications/art-store-ecommerce/src/components/UserProvider.js"],"names":["React","useState","useContext","createContext","useHistory","createUserWithEmailAndPassword","signInWithEmailAndPassword","signOut","getToken","getUser","addUser","getCartItems","UserContext","useUser","UserProvider","props","history","user","setUser","currentError","setCurrentError","updateState","userData","console","log","push","handleSubmitSignUp","event","email","password","preventDefault","authUser","uid","error","handleSubmitLogin","token","cart","handleSignOut","result","handleAddToCartClick","item","addItemToCart","id","children"],"mappings":"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","sourcesContent":["import React, { useState, useContext, createContext } from \"react\";\r\nimport { useHistory } from \"react-router-dom\";\r\n\r\nimport {\r\n  createUserWithEmailAndPassword,\r\n  signInWithEmailAndPassword,\r\n  signOut,\r\n  getToken,\r\n} from \"../firebase/auth\";\r\n\r\nimport { getUser, addUser, getCartItems } from \"../firebase/userRepository\";\r\n\r\n// import { addItemToCart } from \"../api/itemRepository\";\r\n\r\nconst UserContext = createContext();\r\nexport const useUser = () => useContext(UserContext);\r\n\r\nexport default function UserProvider(props) {\r\n  const history = useHistory();\r\n\r\n  const [user, setUser] = useState(null);\r\n  const [currentError, setCurrentError] = useState(null);\r\n\r\n  const updateState = (userData) => {\r\n    console.log(userData);\r\n    setUser({\r\n      ...userData,\r\n    });\r\n    setCurrentError(null);\r\n    history.push(\"/\");\r\n  };\r\n\r\n  const handleSubmitSignUp = async (event, email, password) => {\r\n    event.preventDefault();\r\n    try {\r\n      const authUser = await createUserWithEmailAndPassword(email, password);\r\n      const userData = addUser({ email, uid: authUser.user.uid });\r\n      updateState(userData);\r\n    } catch (error) {\r\n      setCurrentError(error);\r\n    }\r\n  };\r\n\r\n  const handleSubmitLogin = async (event, email, password) => {\r\n    event.preventDefault();\r\n    try {\r\n      const authUser = await signInWithEmailAndPassword(email, password);\r\n      const token = await getToken();\r\n      const userData = await getUser(authUser.user.uid);\r\n      userData.token = token;\r\n      userData.cart = await getCartItems(authUser.user.uid);\r\n      updateState(userData);\r\n    } catch (error) {\r\n      setCurrentError(error);\r\n    }\r\n  };\r\n\r\n  const handleSignOut = async () => {\r\n    try {\r\n      console.log(\"Calling signOut\");\r\n      const result = await signOut();\r\n      console.log(result);\r\n      setUser(null);\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  };\r\n\r\n  const handleAddToCartClick = async (item) => {\r\n    try {\r\n      await addItemToCart(user.uid, item.id, user.token);\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <UserContext.Provider\r\n      value={{\r\n        user,\r\n        error: currentError,\r\n        handleSubmitSignUp,\r\n        handleSubmitLogin,\r\n        handleSignOut,\r\n        handleAddToCartClick,\r\n      }}\r\n    >\r\n      {props.children}\r\n    </UserContext.Provider>\r\n  );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}